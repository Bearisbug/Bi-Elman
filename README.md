# Bi-Elman Attention Networks 网络

本项目展示了一个基于 MindSpore 实现的文本分类网络 —— **Bi-Elman Attention Networks**。

## 目录

- [项目简介](#项目简介)
- [数据集准备](#数据集准备)
- [网络结构](#网络结构)
  - [嵌入层](#嵌入层)
  - [双向 RNN 层](#双向-rnn-层)
  - [层归一化](#层归一化)
  - [注意力机制](#注意力机制)
  - [全连接分类器](#全连接分类器)
- [训练与优化](#训练与优化)
- [可视化与评估](#可视化与评估)
- [运行说明](#运行说明)
- [参考资料](#参考资料)


## 项目简介

该项目实现了一个用于文本分类的深度学习网络。主要流程包括：
- 利用预训练的 GloVe 词向量初始化嵌入矩阵；
- 采用双向 Elman RNN 捕捉上下文信息；
- 结合注意力机制对隐藏状态进行加权求和，获得文本表示；
- 通过全连接层输出最终类别预测。


## 数据集准备

- **数据来源**  
  本项目采用 AG News 数据集，数据可从以下地址下载：  
  [AG News CSV 数据集](https://github.com/mhjabreel/CharCnn_Keras/tree/master/data/ag_news_csv)

- **数据文件**  
  下载后请将数据集中的 `train.csv` 和 `test.csv` 文件放在项目根目录下。

- **数据预处理**  
  数据加载部分利用 MindSpore 提供的 `CSVDataset` 模块读取 CSV 文件，并通过自定义预处理函数拼接新闻标题和描述，同时调整标签为从 0 开始。数据预处理及数据增强（同义词替换、随机删除）均在代码中实现，保证网络训练前的文本数据质量。


## 网络结构

### 嵌入层

- **作用**：将输入的词 id 序列映射为稠密的词向量表示。  
- **特点**：  
  - 使用预训练 GloVe 词向量进行初始化；
  - 支持对填充符号（PAD）的处理，保证输入序列对齐。

### 双向 RNN 层

- **作用**：通过双向 RNN 同时捕获文本的正向和反向信息。  
- **参数**：  
  - 输入维度与嵌入层输出一致；
  - 隐藏层维度可调，多层堆叠（代码中使用 2 层，可自行调整）；
  - 使用 tanh 激活函数。

### 层归一化

- **作用**：对 RNN 的输出进行归一化处理，缓解梯度消失及训练不稳定问题。  
- **实现**：采用 MindSpore 内置的 LayerNorm 层。

### 注意力机制

- **作用**：为每个时间步的隐藏状态计算注意力得分，并通过加权求和获得全局上下文表示。  
- **过程**：  
  1. 利用全连接层计算注意力得分；
  2. 通过 softmax 归一化注意力得分；
  3. 将注意力权重与归一化后的 RNN 输出相乘后求和，得到上下文向量。

### 全连接分类器

- **作用**：将注意力机制获得的上下文向量映射到类别空间，输出最终分类结果。  
- **细节**：  
  - 输出层为全连接层，节点数等于类别数量；
  - 输出未经过激活函数（直接输入交叉熵损失函数）。


## 训练与优化

- **损失函数**：采用交叉熵损失函数。  
- **优化器**：使用 Adam 优化器，学习率设置为 0.001。  
- **训练流程**：  
  - 每个 epoch 调用 `train_one_epoch` 完成前向传播、损失计算、反向传播及参数更新；
  - 每个 epoch 结束后保存模型 checkpoint 以便后续加载与调试。


## 可视化与评估

- **评估指标**：  
  - 通过准确率（Accuracy）和宏平均 F1 分数（Macro F1）量化模型性能；
  - 输出详细的分类报告（包含精确率、召回率等）。

- **可视化内容**：  
  - **Loss 曲线**：展示训练与验证过程中的损失变化；
  - **准确率曲线**：展示训练与验证准确率的变化；
  - **混淆矩阵**：直观展示不同类别之间的预测情况；
  - **注意力权重图**：展示单个测试样本中各词汇对应的注意力权重。

生成的图像文件包括：`ms_loss_curve.png`、`ms_accuracy_curve.png`、`ms_confusion_matrix.png`、`ms_attention_weights_sample.png`。


## 运行说明

1. **数据与预训练词向量准备**  
   - 下载 AG News 数据集（`train.csv` 和 `test.csv`）并放置于项目根目录。  
   - 下载 `glove.6B.100d.txt` 文件，并放置于项目根目录，用于初始化嵌入矩阵。

2. **环境配置**  
   - 安装所需依赖包。  
   - 如有网络限制，可根据需要配置代理环境变量。

3. **运行代码**  
   使用以下命令运行代码：  
   ```bash
   python bielman_mindspore.py
   ```
   程序将自动执行数据预处理、模型训练、评估及结果可视化。

4. **模型输出**  
   - 每个 epoch 后，模型参数将保存在 `checkpoints` 文件夹中；
   - 生成的图像文件用于分析模型训练效果。


## 参考资料

- [AG News CSV 数据集](https://github.com/mhjabreel/CharCnn_Keras/tree/master/data/ag_news_csv)
- [GloVe: Global Vectors for Word Representation](https://nlp.stanford.edu/projects/glove/)
- [MindSpore 官方文档](https://www.mindspore.cn)

---
